<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ê²½ì œê¸ˆìœµìš©ì–´ í•™ìŠµ</title>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); color: #eee; min-height: 100vh; }
    
    .header { background: rgba(0,0,0,0.3); padding: 16px 24px; border-bottom: 1px solid rgba(255,255,255,0.1); position: sticky; top: 0; z-index: 100; }
    .header-inner { max-width: 900px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 16px; }
    .title { font-size: 1.4rem; background: linear-gradient(90deg, #00d4ff, #7c3aed); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
    .subtitle { font-size: 0.8rem; color: #888; margin-top: 4px; }
    .header-right { display: flex; align-items: center; gap: 16px; flex-wrap: wrap; }
    .user-info { display: flex; align-items: center; gap: 10px; font-size: 0.85rem; }
    .user-photo { width: 32px; height: 32px; border-radius: 50%; }
    .user-name { color: #ccc; }
    .auth-btn { padding: 8px 16px; border-radius: 8px; border: none; cursor: pointer; font-size: 0.85rem; }
    .logout-btn { background: rgba(255,255,255,0.1); color: #ccc; }
    .logout-btn:hover { background: rgba(255,255,255,0.2); }
    .progress-box { min-width: 150px; }
    .progress-label { display: flex; justify-content: space-between; font-size: 0.75rem; color: #888; }
    .progress-bar { background: rgba(255,255,255,0.1); border-radius: 8px; height: 8px; overflow: hidden; margin-top: 6px; }
    .progress-fill { height: 100%; background: linear-gradient(90deg, #00c853, #00e676); transition: width 0.5s; }
    
    .streak-box { display: flex; align-items: center; gap: 8px; padding: 8px 14px; background: rgba(255,150,0,0.15); border: 1px solid rgba(255,150,0,0.3); border-radius: 20px; }
    .streak-fire { font-size: 1.2rem; }
    .streak-info { display: flex; flex-direction: column; }
    .streak-count { font-size: 0.9rem; font-weight: 700; color: #ff9800; }
    .streak-best { font-size: 0.65rem; color: #888; }
    
    .tabs { display: flex; background: rgba(0,0,0,0.2); padding: 0 24px; overflow-x: auto; }
    .tab { padding: 14px 20px; background: none; border: none; border-bottom: 2px solid transparent; color: #888; cursor: pointer; font-size: 0.9rem; white-space: nowrap; }
    .tab.active { border-bottom-color: #00d4ff; color: #00d4ff; }
    
    main { max-width: 900px; margin: 0 auto; padding: 24px; }
    
    .login-screen { text-align: center; padding: 80px 20px; }
    .login-icon { font-size: 4rem; margin-bottom: 24px; }
    .login-title { font-size: 1.8rem; margin-bottom: 12px; }
    .login-desc { color: #888; margin-bottom: 32px; line-height: 1.6; }
    .google-login-btn { padding: 14px 32px; background: white; color: #333; border: none; border-radius: 8px; font-size: 1rem; cursor: pointer; display: inline-flex; align-items: center; gap: 12px; }
    .google-login-btn:hover { background: #f1f1f1; }
    .google-logo { width: 20px; height: 20px; }
    
    .day-select-header { text-align: center; margin-bottom: 32px; }
    .day-select-header h2 { font-size: 1.5rem; margin-bottom: 8px; }
    .day-select-header p { color: #888; }
    .day-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 16px; }
    .day-card { background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 16px; padding: 20px; text-align: center; cursor: pointer; transition: all 0.2s; position: relative; }
    .day-card:hover { background: rgba(255,255,255,0.1); transform: translateY(-2px); }
    .day-card.completed { border-color: rgba(0,200,83,0.5); background: rgba(0,200,83,0.1); }
    .day-number { font-size: 1.3rem; font-weight: 700; color: #00d4ff; margin-bottom: 8px; }
    .day-card.completed .day-number { color: #00c853; }
    .day-terms { font-size: 0.7rem; color: #888; line-height: 1.4; height: 40px; overflow: hidden; }
    .day-stamp { position: absolute; top: -8px; right: -8px; width: 36px; height: 36px; background: #00c853; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; box-shadow: 0 2px 8px rgba(0,200,83,0.4); }
    .day-progress { margin-top: 10px; font-size: 0.75rem; color: #666; }
    .day-card.completed .day-progress { color: #00c853; }
    
    .day-nav { display: flex; align-items: center; justify-content: space-between; margin-bottom: 24px; }
    .nav-btn { padding: 10px 20px; background: rgba(0,212,255,0.15); border: 1px solid rgba(0,212,255,0.3); border-radius: 8px; color: #00d4ff; cursor: pointer; font-size: 0.9rem; }
    .nav-btn:disabled { background: rgba(255,255,255,0.05); color: #555; cursor: default; border-color: rgba(255,255,255,0.1); }
    .back-btn { background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); color: #aaa; }
    .back-btn:hover { background: rgba(255,255,255,0.15); }
    .day-title { text-align: center; }
    .day-title h2 { font-size: 1.6rem; margin-bottom: 4px; }
    .day-title p { font-size: 0.85rem; color: #888; }
    
    .card { background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 16px; margin-bottom: 16px; overflow: hidden; }
    .card.learned { border-color: rgba(0,255,100,0.4); }
    .card.bookmarked { border-color: rgba(255,215,0,0.5); }
    .card-header { padding: 18px 20px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; }
    .card-header:hover { background: rgba(255,255,255,0.03); }
    .card-left { display: flex; align-items: center; gap: 14px; }
    .card-num { width: 32px; height: 32px; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-weight: 700; color: #fff; font-size: 0.9rem; }
    .card-term { font-size: 1.1rem; font-weight: 600; margin-bottom: 4px; }
    .card-category { font-size: 0.7rem; color: #888; background: rgba(255,255,255,0.1); padding: 2px 8px; border-radius: 4px; display: inline-block; }
    .card-right { display: flex; align-items: center; gap: 10px; }
    .badge-done { background: rgba(0,200,83,0.2); color: #00c853; padding: 4px 10px; border-radius: 12px; font-size: 0.75rem; }
    .badge-bookmark { background: rgba(255,215,0,0.2); color: #ffd700; padding: 4px 10px; border-radius: 12px; font-size: 0.75rem; }
    .arrow { color: #888; transition: transform 0.3s; font-size: 0.8rem; }
    .arrow.open { transform: rotate(180deg); }
    
    .card-body { padding: 20px; border-top: 1px solid rgba(255,255,255,0.1); display: none; }
    .card-body.open { display: block; }
    
    .section { margin-bottom: 20px; }
    .section:last-child { margin-bottom: 0; }
    .section-title { margin-bottom: 10px; font-size: 0.8rem; font-weight: 600; text-transform: uppercase; letter-spacing: 1px; }
    .section-text { font-size: 0.95rem; line-height: 1.8; color: #ccc; white-space: pre-line; }
    
    .highlight-box { padding: 14px; border-radius: 10px; }
    .bg-yellow { background: rgba(251,191,36,0.1); border-left: 3px solid #fbbf24; }
    .bg-pink { background: rgba(244,114,182,0.1); }
    
    .color-blue { color: #00d4ff; }
    .color-yellow { color: #fbbf24; }
    .color-green { color: #34d399; }
    .color-pink { color: #f472b6; }
    .color-orange { color: #fb923c; }
    .color-purple { color: #a78bfa; }
    
    .flow-box { background: rgba(124,58,237,0.1); border-radius: 12px; padding: 16px; }
    .flow-title { font-size: 0.95rem; color: #a78bfa; margin-bottom: 12px; font-weight: 600; }
    .flow-steps { display: flex; flex-wrap: wrap; gap: 8px; align-items: center; }
    .flow-step { background: rgba(124,58,237,0.3); padding: 8px 14px; border-radius: 20px; font-size: 0.85rem; }
    .flow-arrow { color: #a78bfa; }
    .flow-insight { margin-top: 12px; font-size: 0.85rem; color: #a78bfa; font-style: italic; }
    
    .tags { display: flex; flex-wrap: wrap; gap: 8px; }
    .tag { background: rgba(124,58,237,0.2); color: #a78bfa; padding: 4px 12px; border-radius: 16px; font-size: 0.8rem; }
    
    .card-actions { display: flex; gap: 12px; margin-top: 20px; }
    .learn-btn { flex: 1; padding: 14px; background: linear-gradient(90deg, #00c853, #00e676); border: none; border-radius: 10px; color: #000; font-size: 1rem; font-weight: 600; cursor: pointer; }
    .learn-btn:hover { opacity: 0.9; }
    .bookmark-btn { padding: 14px 20px; background: rgba(255,215,0,0.15); border: 1px solid rgba(255,215,0,0.3); border-radius: 10px; color: #ffd700; font-size: 1rem; cursor: pointer; transition: all 0.2s; }
    .bookmark-btn:hover { background: rgba(255,215,0,0.25); }
    .bookmark-btn.active { background: rgba(255,215,0,0.3); border-color: #ffd700; }
    
    .quiz-box { background: rgba(255,255,255,0.05); border-radius: 16px; padding: 32px; max-width: 600px; margin: 0 auto; }
    .quiz-center { text-align: center; padding: 40px 0; }
    .quiz-icon { font-size: 3.5rem; margin-bottom: 16px; }
    .quiz-title { font-size: 1.4rem; margin-bottom: 10px; }
    .quiz-info { color: #888; margin-bottom: 20px; }
    .quiz-count { color: #00d4ff; margin-bottom: 24px; }
    .quiz-label { color: #00d4ff; font-size: 0.9rem; margin-bottom: 16px; }
    .quiz-question { background: rgba(255,255,255,0.05); padding: 20px; border-radius: 12px; line-height: 1.7; margin-bottom: 24px; }
    .quiz-option { display: block; width: 100%; padding: 16px; margin: 8px 0; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 10px; color: #eee; font-size: 1rem; text-align: left; cursor: pointer; }
    .quiz-option:hover:not(:disabled) { background: rgba(255,255,255,0.1); }
    .quiz-option.correct { background: rgba(0,200,83,0.2); border: 2px solid #00c853; }
    .quiz-option.wrong { background: rgba(255,50,50,0.2); border: 2px solid #f44; }
    .quiz-option:disabled { cursor: default; }
    .quiz-result { margin-top: 20px; font-size: 1.2rem; text-align: center; }
    .quiz-next { margin-top: 12px; padding: 10px 24px; background: rgba(0,212,255,0.2); border: 1px solid #00d4ff; border-radius: 8px; color: #00d4ff; cursor: pointer; }
    .quiz-end { margin-top: 20px; width: 100%; padding: 12px; background: none; border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: #888; cursor: pointer; }
    
    .search-input { width: 100%; padding: 16px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; color: #fff; font-size: 1rem; margin-bottom: 20px; }
    .search-input::placeholder { color: #666; }
    .search-count { color: #888; margin-bottom: 16px; }
    .search-item { padding: 16px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; margin-bottom: 12px; }
    .search-item-header { display: flex; justify-content: space-between; margin-bottom: 8px; align-items: center; }
    .search-item-title { font-size: 1rem; font-weight: 600; }
    .search-item-desc { font-size: 0.9rem; color: #888; line-height: 1.5; }
    
    .wordlist-header { margin-bottom: 20px; }
    .filter-btns { display: flex; gap: 10px; margin-bottom: 12px; flex-wrap: wrap; }
    .filter-btn { padding: 10px 18px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 20px; color: #888; cursor: pointer; font-size: 0.85rem; transition: all 0.2s; }
    .filter-btn:hover { background: rgba(255,255,255,0.1); }
    .filter-btn.active { background: rgba(0,212,255,0.2); border-color: #00d4ff; color: #00d4ff; }
    .filter-btn.bookmark-filter.active { background: rgba(255,215,0,0.2); border-color: #ffd700; color: #ffd700; }
    .wordlist-count { color: #888; font-size: 0.9rem; }
    .wordlist-item { padding: 16px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; margin-bottom: 12px; cursor: pointer; transition: all 0.2s; }
    .wordlist-item:hover { background: rgba(255,255,255,0.08); }
    .wordlist-item.completed { border-left: 3px solid #00c853; }
    .wordlist-item.incomplete { border-left: 3px solid #888; }
    .wordlist-item.bookmarked-item { border-left: 3px solid #ffd700; }
    .wordlist-item-header { display: flex; justify-content: space-between; margin-bottom: 8px; align-items: center; gap: 8px; }
    .wordlist-item-title { font-size: 1rem; font-weight: 600; }
    .wordlist-item-badges { display: flex; gap: 6px; }
    .wordlist-item-status { font-size: 0.75rem; padding: 4px 10px; border-radius: 12px; }
    .wordlist-item-status.done { background: rgba(0,200,83,0.2); color: #00c853; }
    .wordlist-item-status.notdone { background: rgba(255,255,255,0.1); color: #888; }
    .wordlist-item-status.bookmarked { background: rgba(255,215,0,0.2); color: #ffd700; }
    .wordlist-item-desc { font-size: 0.85rem; color: #888; line-height: 1.5; }
    .wordlist-item-day { font-size: 0.75rem; color: #00d4ff; margin-top: 8px; }
    
    /* ì¹´í…Œê³ ë¦¬ ì„¹ì…˜ ìŠ¤íƒ€ì¼ */
    .category-header { text-align: center; margin-bottom: 24px; }
    .category-header h2 { font-size: 1.5rem; margin-bottom: 8px; }
    .category-header p { color: #888; }
    .category-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 12px; margin-bottom: 24px; }
    .category-card { background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; padding: 16px; text-align: center; cursor: pointer; transition: all 0.2s; }
    .category-card:hover { background: rgba(255,255,255,0.1); transform: translateY(-2px); }
    .category-card.active { background: rgba(0,212,255,0.15); border-color: #00d4ff; }
    .category-icon { font-size: 1.8rem; margin-bottom: 8px; }
    .category-name { font-size: 0.9rem; font-weight: 600; margin-bottom: 4px; }
    .category-count { font-size: 0.75rem; color: #888; }
    .category-progress { margin-top: 8px; height: 4px; background: rgba(255,255,255,0.1); border-radius: 2px; overflow: hidden; }
    .category-progress-fill { height: 100%; background: linear-gradient(90deg, #00c853, #00e676); }
    
    .category-list-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; padding-bottom: 16px; border-bottom: 1px solid rgba(255,255,255,0.1); }
    .category-list-title { font-size: 1.2rem; font-weight: 600; }
    .category-back-btn { padding: 8px 16px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: #aaa; cursor: pointer; font-size: 0.85rem; }
    .category-back-btn:hover { background: rgba(255,255,255,0.15); }
    
    /* ë¶ë§ˆí¬ ì„¹ì…˜ ìŠ¤íƒ€ì¼ */
    .bookmark-header { text-align: center; margin-bottom: 24px; }
    .bookmark-header h2 { font-size: 1.5rem; margin-bottom: 8px; color: #ffd700; }
    .bookmark-header p { color: #888; }
    .bookmark-empty { text-align: center; padding: 60px 20px; color: #888; }
    .bookmark-empty-icon { font-size: 3rem; margin-bottom: 16px; }
    
    footer { text-align: center; padding: 24px; color: #666; font-size: 0.8rem; border-top: 1px solid rgba(255,255,255,0.1); }
    
    .loading { text-align: center; padding: 60px; color: #888; }
    .spinner { width: 40px; height: 40px; border: 3px solid rgba(255,255,255,0.1); border-top-color: #00d4ff; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 16px; }
    @keyframes spin { to { transform: rotate(360deg); } }
    
    .hidden { display: none !important; }
  </style>
</head>
<body>
  <header class="header">
    <div class="header-inner">
      <div>
        <h1 class="title">ğŸ’° ê²½ì œê¸ˆìœµìš©ì–´ í•™ìŠµ</h1>
        <p class="subtitle">ì´ˆë³´ìë¥¼ ìœ„í•œ ìƒì„¸ ì„¤ëª… + ê²½ì œ íë¦„</p>
      </div>
      <div class="header-right">
        <div id="userArea"></div>
        <div class="streak-box" id="streakBox" style="display:none">
          <span class="streak-fire">ğŸ”¥</span>
          <div class="streak-info">
            <span class="streak-count" id="streakCount">0ì¼ ì—°ì†</span>
            <span class="streak-best" id="streakBest">ìµœì¥ 0ì¼</span>
          </div>
        </div>
        <div class="progress-box" id="progressBox" style="display:none">
          <div class="progress-label">
            <span>ì „ì²´ ì§„ë„</span>
            <span id="progressPercent">0%</span>
          </div>
          <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
          </div>
        </div>
      </div>
    </div>
  </header>

  <div class="tabs" id="tabsContainer" style="display:none">
    <button class="tab active" id="tabLearn">ğŸ“š í•™ìŠµí•˜ê¸°</button>
    <button class="tab" id="tabCategory">ğŸ“‚ ì¹´í…Œê³ ë¦¬</button>
    <button class="tab" id="tabBookmark">â­ ë¶ë§ˆí¬</button>
    <button class="tab" id="tabWordList">ğŸ“‹ ë‚´ ë‹¨ì–´ì¥</button>
    <button class="tab" id="tabQuiz">âœï¸ í€´ì¦ˆ</button>
    <button class="tab" id="tabSearch">ğŸ” ê²€ìƒ‰</button>
  </div>

  <main>
    <div id="loginScreen">
      <div class="login-screen">
        <div class="login-icon">ğŸ“š</div>
        <h2 class="login-title">ê²½ì œê¸ˆìœµìš©ì–´ í•™ìŠµ</h2>
        <p class="login-desc">Google ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸í•˜ë©´<br>í•™ìŠµ ì§„ë„ê°€ ìë™ìœ¼ë¡œ ì €ì¥ë©ë‹ˆë‹¤.</p>
        <button class="google-login-btn" id="googleLoginBtn">
          <svg class="google-logo" viewBox="0 0 24 24">
            <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
            <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
            <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
            <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
          </svg>
          Googleë¡œ ë¡œê·¸ì¸
        </button>
      </div>
    </div>

    <div id="appContainer" style="display:none">
      <div id="daySelectSection">
        <div class="day-select-header">
          <h2>ğŸ“… í•™ìŠµí•  Dayë¥¼ ì„ íƒí•˜ì„¸ìš”</h2>
          <p>í•˜ë£¨ 4ê°œ ìš©ì–´ì”© í•™ìŠµí•´ìš”</p>
        </div>
        <div class="day-grid" id="dayGrid">
          <div class="loading"><div class="spinner"></div><p>ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p></div>
        </div>
      </div>

      <div id="learnSection" class="hidden">
        <div class="day-nav">
          <button class="nav-btn back-btn" id="backToDaysBtn">â† Day ëª©ë¡</button>
          <div class="day-title">
            <h2 id="dayTitle">Day 1</h2>
            <p id="dayCount">0ê°œ ìš©ì–´</p>
          </div>
          <button class="nav-btn" id="nextDayBtn">ë‹¤ìŒ Day â†’</button>
        </div>
        <div id="cardsContainer"></div>
      </div>

      <!-- ì¹´í…Œê³ ë¦¬ ì„¹ì…˜ -->
      <div id="categorySection" class="hidden">
        <div id="categoryGridView">
          <div class="category-header">
            <h2>ğŸ“‚ ì¹´í…Œê³ ë¦¬ë³„ í•™ìŠµ</h2>
            <p>ì›í•˜ëŠ” ë¶„ì•¼ë¥¼ ì„ íƒí•´ì„œ í•™ìŠµí•˜ì„¸ìš”</p>
          </div>
          <div class="category-grid" id="categoryGrid"></div>
        </div>
        <div id="categoryListView" class="hidden">
          <div class="category-list-header">
            <span class="category-list-title" id="categoryListTitle">ì¹´í…Œê³ ë¦¬ëª…</span>
            <button class="category-back-btn" id="categoryBackBtn">â† ì¹´í…Œê³ ë¦¬ ëª©ë¡</button>
          </div>
          <div id="categoryListResults"></div>
        </div>
      </div>

      <!-- ë¶ë§ˆí¬ ì„¹ì…˜ -->
      <div id="bookmarkSection" class="hidden">
        <div class="bookmark-header">
          <h2>â­ ë¶ë§ˆí¬í•œ ìš©ì–´</h2>
          <p>ì¤‘ìš”í•œ ìš©ì–´ë¥¼ ëª¨ì•„ì„œ ë³µìŠµí•˜ì„¸ìš”</p>
        </div>
        <div id="bookmarkResults"></div>
      </div>

      <div id="quizSection" class="hidden">
        <div class="quiz-box"><div id="quizContent"></div></div>
      </div>

      <div id="searchSection" class="hidden">
        <input type="text" class="search-input" placeholder="ìš©ì–´ ë˜ëŠ” ì„¤ëª… ê²€ìƒ‰..." id="searchInput">
        <p class="search-count" id="searchCount"></p>
        <div id="searchResults"></div>
      </div>

      <div id="wordListSection" class="hidden">
        <div class="wordlist-header">
          <div class="filter-btns">
            <button class="filter-btn active" data-filter="all">ì „ì²´</button>
            <button class="filter-btn" data-filter="completed">âœ“ í•™ìŠµì™„ë£Œ</button>
            <button class="filter-btn" data-filter="incomplete">â—‹ ë¯¸í•™ìŠµ</button>
            <button class="filter-btn bookmark-filter" data-filter="bookmarked">â­ ë¶ë§ˆí¬</button>
          </div>
          <p class="wordlist-count" id="wordListCount"></p>
        </div>
        <div id="wordListResults"></div>
      </div>
    </div>
  </main>

  <footer>ì¶œì²˜: í•œêµ­ì€í–‰ ã€Œê²½ì œê¸ˆìœµìš©ì–´ 700ì„ ã€ (2024)</footer>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyA1JqzYJ_pODEKOikJmOWv09np66d1_e84",
      authDomain: "basic-economic-terms.firebaseapp.com",
      projectId: "basic-economic-terms",
      storageBucket: "basic-economic-terms.firebasestorage.app",
      messagingSenderId: "533185962456",
      appId: "1:533185962456:web:b0ab0258078848170ed2ad"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    let currentUser = null;
    let allTerms = [];
    let currentDay = 1;
    let totalDays = 1;
    let progress = {};
    let bookmarks = {}; // ë¶ë§ˆí¬ ë°ì´í„°
    let expandedId = null;
    let quizData = null;
    let currentView = 'daySelect';
    let wordListFilter = 'all';
    let streakData = { currentStreak: 0, longestStreak: 0, lastStudyDate: null };
    let selectedCategory = null;

    // ì¹´í…Œê³ ë¦¬ ì•„ì´ì½˜ ë§¤í•‘
    const categoryIcons = {
      'ê¸ˆìœµ': 'ğŸ¦', 'ê¸ˆìœµì‹œì¥': 'ğŸ“Š', 'ê¸ˆìœµìƒí’ˆ': 'ğŸ’³', 'í†µí™”': 'ğŸ’µ', 'í†µí™”ì •ì±…': 'ğŸ›ï¸',
      'í†µí™”ì´ë¡ ': 'ğŸ“–', 'ê²½ì œì›ë¦¬': 'ğŸ“ˆ', 'ê²½ì œì´ë¡ ': 'ğŸ“', 'ê²½ì œì •ì±…': 'ğŸ“‹', 'êµ­ì œê¸ˆìœµ': 'ğŸŒ',
      'êµ­ì œìˆ˜ì§€': 'âš–ï¸', 'ì™¸í™˜': 'ğŸ’±', 'ì±„ê¶Œ': 'ğŸ“œ', 'ì£¼ì‹': 'ğŸ“‰', 'ì¦ê¶Œ': 'ğŸ“‘',
      'ê²°ì œ': 'ğŸ’¸', 'ê²°ì œì‹œìŠ¤í…œ': 'ğŸ”„', 'ê²°ì œì¸í”„ë¼': 'ğŸ–¥ï¸', 'ë¬´ì—­': 'ğŸš¢', 'ë¬´ì—­ê¸ˆìœµ': 'ğŸ­',
      'ì¬ì •': 'ğŸ¢', 'ì„¸ê¸ˆ': 'ğŸ’°', 'êµ­ë¯¼ê³„ì •': 'ğŸ“Š', 'ê¸ˆìœµê·œì œ': 'âš ï¸', 'ê¸ˆìœµê°ë…': 'ğŸ‘ï¸',
      'ê¸ˆìœµì•ˆì •': 'ğŸ›¡ï¸', 'ë¦¬ìŠ¤í¬': 'âš¡', 'ì‚°ì—…ë¶„ì„': 'ğŸ”¬', 'í†µê³„': 'ğŸ“‰', 'ê²½ê¸°ì§€í‘œ': 'ğŸ“Š',
      'í™”í': 'ğŸª™', 'í™˜ìœ¨': 'ğŸ’¹', 'ì¸í”„ë¼': 'ğŸ—ï¸', 'ê²½ì˜': 'ğŸ‘”', 'êµ­ì œê¸°êµ¬': 'ğŸŒ',
      'êµ­ì œê·œë²”': 'ğŸ“', 'ì¤‘ì•™ì€í–‰': 'ğŸ›ï¸', 'êµ¬ì¡°í™”ìƒí’ˆ': 'ğŸ§©', 'ì±„ê¶Œë°œí–‰': 'ğŸ“„', 'ê¸ˆìœµë°œì „': 'ğŸš€',
      'ê¸ˆìœµêµ¬ì¡°': 'ğŸ›ï¸', 'ê¸ˆìœµì¸í”„ë¼': 'âš™ï¸', 'í™˜ê²½ê²½ì œ': 'ğŸŒ±'
    };

    auth.onAuthStateChanged(async (user) => {
      currentUser = user;
      if (user) {
        showApp();
        await loadUserProgress();
        await loadTerms();
      } else {
        showLogin();
      }
    });

    function showLogin() {
      document.getElementById('loginScreen').style.display = 'block';
      document.getElementById('appContainer').style.display = 'none';
      document.getElementById('tabsContainer').style.display = 'none';
      document.getElementById('progressBox').style.display = 'none';
      document.getElementById('streakBox').style.display = 'none';
      document.getElementById('userArea').innerHTML = '';
    }

    function showApp() {
      document.getElementById('loginScreen').style.display = 'none';
      document.getElementById('appContainer').style.display = 'block';
      document.getElementById('tabsContainer').style.display = 'flex';
      document.getElementById('progressBox').style.display = 'block';
      document.getElementById('streakBox').style.display = 'flex';
      
      document.getElementById('userArea').innerHTML = `
        <div class="user-info">
          <img class="user-photo" src="${currentUser.photoURL || ''}" alt="" onerror="this.style.display='none'">
          <span class="user-name">${currentUser.displayName || currentUser.email}</span>
          <button class="auth-btn logout-btn" id="resetProgressBtn" style="background:rgba(244,67,54,0.2);color:#f44;">ì´ˆê¸°í™”</button>
          <button class="auth-btn logout-btn" id="logoutBtn">ë¡œê·¸ì•„ì›ƒ</button>
        </div>
      `;
    }

    document.getElementById('googleLoginBtn').addEventListener('click', async () => {
      try {
        await auth.signInWithPopup(new firebase.auth.GoogleAuthProvider());
      } catch (err) {
        alert('ë¡œê·¸ì¸ ì‹¤íŒ¨: ' + err.message);
      }
    });

    document.getElementById('userArea').addEventListener('click', async (e) => {
      if (e.target.id === 'logoutBtn') auth.signOut();
      if (e.target.id === 'resetProgressBtn') {
        if (confirm('ì •ë§ ëª¨ë“  í•™ìŠµ ì§„ë„ë¥¼ ì´ˆê¸°í™”í•˜ì‹œê² ì–´ìš”?\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) {
          progress = {};
          bookmarks = {};
          streakData = { currentStreak: 0, longestStreak: 0, lastStudyDate: null };
          await saveProgress();
          alert('ì§„ë„ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤!');
          if (currentView === 'learning') {
            renderCards();
          } else {
            renderDayGrid();
          }
        }
      }
    });

    async function loadUserProgress() {
      if (!currentUser) return;
      try {
        const doc = await db.collection('users').doc(currentUser.uid).get();
        if (doc.exists) {
          const data = doc.data();
          progress = data.progress || {};
          bookmarks = data.bookmarks || {};
          streakData = {
            currentStreak: data.currentStreak || 0,
            longestStreak: data.longestStreak || 0,
            lastStudyDate: data.lastStudyDate || null
          };
          checkStreakOnLoad();
        } else {
          progress = {};
          bookmarks = {};
          streakData = { currentStreak: 0, longestStreak: 0, lastStudyDate: null };
        }
        updateStreakUI();
      } catch (err) {
        console.error('ì§„ë„ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:', err);
        progress = {};
        bookmarks = {};
        streakData = { currentStreak: 0, longestStreak: 0, lastStudyDate: null };
      }
    }

    function getToday() {
      return new Date().toISOString().split('T')[0];
    }

    function getYesterday() {
      const d = new Date();
      d.setDate(d.getDate() - 1);
      return d.toISOString().split('T')[0];
    }

    function checkStreakOnLoad() {
      const today = getToday();
      const yesterday = getYesterday();
      
      if (streakData.lastStudyDate && 
          streakData.lastStudyDate !== today && 
          streakData.lastStudyDate !== yesterday) {
        streakData.currentStreak = 0;
      }
    }

    function updateStreakOnComplete() {
      const today = getToday();
      const yesterday = getYesterday();
      
      if (streakData.lastStudyDate === today) {
        return false;
      }
      
      if (streakData.lastStudyDate === yesterday) {
        streakData.currentStreak += 1;
      } else if (streakData.lastStudyDate !== today) {
        streakData.currentStreak = 1;
      }
      
      if (streakData.currentStreak > streakData.longestStreak) {
        streakData.longestStreak = streakData.currentStreak;
      }
      
      streakData.lastStudyDate = today;
      return true;
    }

    function updateStreakUI() {
      document.getElementById('streakCount').textContent = streakData.currentStreak + 'ì¼ ì—°ì†';
      document.getElementById('streakBest').textContent = 'ìµœì¥ ' + streakData.longestStreak + 'ì¼';
    }

    async function saveProgress() {
      if (!currentUser) return;
      try {
        await db.collection('users').doc(currentUser.uid).set({
          progress: progress,
          bookmarks: bookmarks,
          currentStreak: streakData.currentStreak,
          longestStreak: streakData.longestStreak,
          lastStudyDate: streakData.lastStudyDate,
          updatedAt: firebase.firestore.FieldValue.serverTimestamp()
        }, { merge: true });
      } catch (err) {
        console.error('ì§„ë„ ì €ì¥ ì‹¤íŒ¨:', err);
      }
      updateProgressBar();
      updateStreakUI();
      renderDayGrid();
    }

    function updateProgressBar() {
      const pct = allTerms.length > 0 ? Math.round((Object.keys(progress).length / allTerms.length) * 100) : 0;
      document.getElementById('progressPercent').textContent = pct + '%';
      document.getElementById('progressFill').style.width = pct + '%';
    }

    async function loadTerms() {
      try {
        const response = await fetch('https://raw.githubusercontent.com/eunhye9254/economic-terms/main/terms.json');
        if (!response.ok) throw new Error('ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
        const terms = await response.json();
        allTerms = terms.map(term => ({ docId: String(term.id), ...term }));
        
        if (allTerms.length === 0) {
          document.getElementById('dayGrid').innerHTML = '<div class="loading"><p>ğŸ“­ ë“±ë¡ëœ ìš©ì–´ê°€ ì—†ìŠµë‹ˆë‹¤.</p></div>';
          return;
        }
        
        totalDays = Math.ceil(allTerms.length / 4);
        renderDayGrid();
        updateProgressBar();
        renderSearch('');
        renderCategoryGrid();
      } catch (err) {
        document.getElementById('dayGrid').innerHTML = '<div class="loading"><p>âš ï¸ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨: ' + err.message + '</p></div>';
      }
    }

    // ì¹´í…Œê³ ë¦¬ ê´€ë ¨ í•¨ìˆ˜ë“¤
    function getCategories() {
      const categoryMap = {};
      allTerms.forEach(term => {
        const cat = term.category || 'ì¼ë°˜';
        if (!categoryMap[cat]) {
          categoryMap[cat] = { terms: [], completed: 0 };
        }
        categoryMap[cat].terms.push(term);
        if (progress[term.docId]) {
          categoryMap[cat].completed++;
        }
      });
      return categoryMap;
    }

    function renderCategoryGrid() {
      const categories = getCategories();
      const sortedCats = Object.entries(categories).sort((a, b) => b[1].terms.length - a[1].terms.length);
      
      document.getElementById('categoryGrid').innerHTML = sortedCats.map(([cat, data]) => {
        const icon = categoryIcons[cat] || 'ğŸ“';
        const progressPct = data.terms.length > 0 ? Math.round((data.completed / data.terms.length) * 100) : 0;
        
        return `
          <div class="category-card" data-category="${cat}">
            <div class="category-icon">${icon}</div>
            <div class="category-name">${cat}</div>
            <div class="category-count">${data.terms.length}ê°œ ìš©ì–´</div>
            <div class="category-progress">
              <div class="category-progress-fill" style="width:${progressPct}%"></div>
            </div>
          </div>
        `;
      }).join('');
    }

    function renderCategoryList(category) {
      const categories = getCategories();
      const data = categories[category];
      if (!data) return;
      
      document.getElementById('categoryListTitle').textContent = `${categoryIcons[category] || 'ğŸ“'} ${category} (${data.terms.length}ê°œ)`;
      
      document.getElementById('categoryListResults').innerHTML = data.terms.map(t => {
        const termIndex = allTerms.findIndex(at => at.docId === t.docId);
        const dayNum = Math.floor(termIndex / 4) + 1;
        const isCompleted = progress[t.docId];
        const isBookmarked = bookmarks[t.docId];
        
        return `
          <div class="wordlist-item ${isCompleted ? 'completed' : 'incomplete'} ${isBookmarked ? 'bookmarked-item' : ''}" data-docid="${t.docId}" data-day="${dayNum}">
            <div class="wordlist-item-header">
              <span class="wordlist-item-title">${t.term}</span>
              <div class="wordlist-item-badges">
                ${isBookmarked ? '<span class="wordlist-item-status bookmarked">â­</span>' : ''}
                <span class="wordlist-item-status ${isCompleted ? 'done' : 'notdone'}">${isCompleted ? 'âœ“ í•™ìŠµì™„ë£Œ' : 'â—‹ ë¯¸í•™ìŠµ'}</span>
              </div>
            </div>
            <p class="wordlist-item-desc">${t.simpleExplanation || t.definition || ''}</p>
            <p class="wordlist-item-day">ğŸ“ Day ${dayNum}</p>
          </div>
        `;
      }).join('');
    }

    // ë¶ë§ˆí¬ ê´€ë ¨ í•¨ìˆ˜
    function toggleBookmark(termId) {
      if (bookmarks[termId]) {
        delete bookmarks[termId];
      } else {
        bookmarks[termId] = true;
      }
      saveProgress();
    }

    function renderBookmarks() {
      const bookmarkedTerms = allTerms.filter(t => bookmarks[t.docId]);
      
      if (bookmarkedTerms.length === 0) {
        document.getElementById('bookmarkResults').innerHTML = `
          <div class="bookmark-empty">
            <div class="bookmark-empty-icon">â­</div>
            <p>ë¶ë§ˆí¬í•œ ìš©ì–´ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
            <p style="margin-top:8px;font-size:0.85rem;">í•™ìŠµ ì¤‘ â­ ë²„íŠ¼ì„ ëˆŒëŸ¬ ë¶ë§ˆí¬í•˜ì„¸ìš”!</p>
          </div>
        `;
        return;
      }
      
      document.getElementById('bookmarkResults').innerHTML = bookmarkedTerms.map(t => {
        const termIndex = allTerms.findIndex(at => at.docId === t.docId);
        const dayNum = Math.floor(termIndex / 4) + 1;
        const isCompleted = progress[t.docId];
        
        return `
          <div class="wordlist-item ${isCompleted ? 'completed' : 'incomplete'} bookmarked-item" data-docid="${t.docId}" data-day="${dayNum}">
            <div class="wordlist-item-header">
              <span class="wordlist-item-title">${t.term}</span>
              <div class="wordlist-item-badges">
                <span class="wordlist-item-status bookmarked">â­</span>
                <span class="wordlist-item-status ${isCompleted ? 'done' : 'notdone'}">${isCompleted ? 'âœ“ í•™ìŠµì™„ë£Œ' : 'â—‹ ë¯¸í•™ìŠµ'}</span>
              </div>
            </div>
            <p class="wordlist-item-desc">${t.simpleExplanation || t.definition || ''}</p>
            <p class="wordlist-item-day">ğŸ“ Day ${dayNum} Â· ${t.category || 'ì¼ë°˜'}</p>
          </div>
        `;
      }).join('');
    }

    function isDayCompleted(dayNumber) {
      const startIdx = (dayNumber - 1) * 4;
      const dayTerms = allTerms.slice(startIdx, startIdx + 4);
      return dayTerms.length > 0 && dayTerms.every(term => progress[term.docId]);
    }

    function getDayProgress(dayNumber) {
      const startIdx = (dayNumber - 1) * 4;
      const dayTerms = allTerms.slice(startIdx, startIdx + 4);
      const completed = dayTerms.filter(term => progress[term.docId]).length;
      return { completed, total: dayTerms.length };
    }

    function getDayTermsPreview(dayNumber) {
      const startIdx = (dayNumber - 1) * 4;
      return allTerms.slice(startIdx, startIdx + 4).map(t => t.term).join(', ');
    }

    function renderDayGrid() {
      let html = '';
      for (let d = 1; d <= totalDays; d++) {
        const completed = isDayCompleted(d);
        const prog = getDayProgress(d);
        const preview = getDayTermsPreview(d);
        
        html += `
          <div class="day-card ${completed ? 'completed' : ''}" data-day="${d}">
            ${completed ? '<div class="day-stamp">âœ“</div>' : ''}
            <div class="day-number">Day ${d}</div>
            <div class="day-terms">${preview}</div>
            <div class="day-progress">${prog.completed}/${prog.total} ì™„ë£Œ</div>
          </div>
        `;
      }
      document.getElementById('dayGrid').innerHTML = html;
    }

    function hideAllSections() {
      document.getElementById('daySelectSection').classList.add('hidden');
      document.getElementById('learnSection').classList.add('hidden');
      document.getElementById('categorySection').classList.add('hidden');
      document.getElementById('bookmarkSection').classList.add('hidden');
      document.getElementById('quizSection').classList.add('hidden');
      document.getElementById('searchSection').classList.add('hidden');
      document.getElementById('wordListSection').classList.add('hidden');
    }

    function showDaySelect() {
      currentView = 'daySelect';
      hideAllSections();
      document.getElementById('daySelectSection').classList.remove('hidden');
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      document.getElementById('tabLearn').classList.add('active');
      renderDayGrid();
    }

    function showLearning(day, keepExpanded = false) {
      currentView = 'learning';
      currentDay = day;
      if (!keepExpanded) expandedId = null;
      hideAllSections();
      document.getElementById('learnSection').classList.remove('hidden');
      renderCards();
    }

    function getDayTerms() {
      return allTerms.slice((currentDay - 1) * 4, currentDay * 4);
    }

    function renderCards() {
      const terms = getDayTerms();
      document.getElementById('dayTitle').textContent = 'Day ' + currentDay;
      document.getElementById('dayCount').textContent = terms.length + 'ê°œ ìš©ì–´';
      document.getElementById('nextDayBtn').disabled = currentDay === totalDays;

      const colors = ['#e74c3c', '#27ae60', '#3498db', '#9b59b6'];
      
      document.getElementById('cardsContainer').innerHTML = terms.map((term, i) => {
        const isOpen = expandedId === term.docId;
        const isLearned = progress[term.docId];
        const isBookmarked = bookmarks[term.docId];
        
        return `
          <div class="card ${isLearned ? 'learned' : ''} ${isBookmarked ? 'bookmarked' : ''}" data-id="${term.docId}">
            <div class="card-header">
              <div class="card-left">
                <div class="card-num" style="background:${colors[i]}">${i + 1}</div>
                <div>
                  <div class="card-term">${term.term || ''}</div>
                  <span class="card-category">${term.category || 'ì¼ë°˜'}</span>
                </div>
              </div>
              <div class="card-right">
                ${isBookmarked ? '<span class="badge-bookmark">â­</span>' : ''}
                ${isLearned ? '<span class="badge-done">âœ“ ì™„ë£Œ</span>' : ''}
                <span class="arrow ${isOpen ? 'open' : ''}">â–¼</span>
              </div>
            </div>
            <div class="card-body ${isOpen ? 'open' : ''}">${renderCardContent(term)}</div>
          </div>
        `;
      }).join('');
    }

    function renderCardContent(term) {
      const isLearned = progress[term.docId];
      const isBookmarked = bookmarks[term.docId];
      
      let html = '';
      if (term.definition) html += `<div class="section"><div class="section-title color-blue">ğŸ“Œ í•µì‹¬ ì •ì˜</div><p class="section-text" style="color:#fff">${term.definition}</p></div>`;
      if (term.simpleExplanation) html += `<div class="section"><div class="section-title color-yellow">ğŸ’¡ ì‰½ê²Œ ì´í•´í•˜ê¸°</div><p class="section-text highlight-box bg-yellow">${term.simpleExplanation}</p></div>`;
      if (term.detailedExplanation) html += `<div class="section"><div class="section-title color-green">ğŸ“– ìì„¸íˆ ì•Œì•„ë³´ê¸°</div><p class="section-text">${term.detailedExplanation}</p></div>`;
      if (term.example) html += `<div class="section"><div class="section-title color-pink">ğŸ“° ì‹¤ì œ ì‚¬ë¡€</div><p class="section-text highlight-box bg-pink">${term.example}</p></div>`;
      if (term.whyImportant) html += `<div class="section"><div class="section-title color-orange">â­ ì™œ ì•Œì•„ì•¼ í• ê¹Œ?</div><p class="section-text">${term.whyImportant}</p></div>`;
      if (term.economicFlow && term.economicFlow.steps) {
        html += `<div class="section"><div class="flow-box"><div class="flow-title">ğŸ”„ ${term.economicFlow.title || 'ê²½ì œ íë¦„'}</div><div class="flow-steps">${term.economicFlow.steps.map((s, i, arr) => `<span class="flow-step">${s}</span>${i < arr.length - 1 ? '<span class="flow-arrow">â†’</span>' : ''}`).join('')}</div>${term.economicFlow.insight ? `<p class="flow-insight">ğŸ’¡ ${term.economicFlow.insight}</p>` : ''}</div></div>`;
      }
      if (term.related && term.related.length > 0) html += `<div class="section"><div class="section-title color-purple">ğŸ”— ì—°ê´€ ìš©ì–´</div><div class="tags">${term.related.map(r => `<span class="tag">${r}</span>`).join('')}</div></div>`;
      
      // ì•¡ì…˜ ë²„íŠ¼ë“¤
      html += `<div class="card-actions">`;
      if (!isLearned) {
        html += `<button class="learn-btn" data-learn="${term.docId}">âœ“ í•™ìŠµ ì™„ë£Œ!</button>`;
      }
      html += `<button class="bookmark-btn ${isBookmarked ? 'active' : ''}" data-bookmark="${term.docId}">${isBookmarked ? 'â­ ë¶ë§ˆí¬ í•´ì œ' : 'â˜† ë¶ë§ˆí¬'}</button>`;
      html += `</div>`;
      
      return html;
    }

    function renderQuiz() {
      const learned = allTerms.filter(t => progress[t.docId]);
      
      if (!quizData) {
        document.getElementById('quizContent').innerHTML = `
          <div class="quiz-center">
            <div class="quiz-icon">ğŸ§ </div>
            <h2 class="quiz-title">ë³µìŠµ í€´ì¦ˆ</h2>
            <p class="quiz-info">í•™ìŠµí•œ ìš©ì–´ ì¤‘ ëœë¤ ì¶œì œ</p>
            <p class="quiz-count">í•™ìŠµ ì™„ë£Œ: ${learned.length}ê°œ</p>
            <button class="learn-btn" style="max-width:200px;margin:0 auto" id="startQuizBtn">í€´ì¦ˆ ì‹œì‘</button>
          </div>
        `;
        return;
      }
      
      const { question, options, selected } = quizData;
      let optHtml = options.map(opt => {
        let cls = 'quiz-option';
        if (selected !== null) {
          if (opt.docId === question.docId) cls += ' correct';
          else if (opt.docId === selected) cls += ' wrong';
        }
        return `<button class="${cls}" data-option="${opt.docId}" ${selected !== null ? 'disabled' : ''}>${opt.term}</button>`;
      }).join('');
      
      let resultHtml = '';
      if (selected !== null) {
        const isCorrect = selected === question.docId;
        resultHtml = `<div class="quiz-result" style="color:${isCorrect ? '#00c853' : '#f44'}">${isCorrect ? 'ğŸ‰ ì •ë‹µ!' : 'âŒ ì˜¤ë‹µ! ì •ë‹µ: ' + question.term}</div><div style="text-align:center"><button class="quiz-next" id="nextQuizBtn">ë‹¤ìŒ ë¬¸ì œ</button></div>`;
      }
      
      document.getElementById('quizContent').innerHTML = `
        <h3 class="quiz-label">ë‹¤ìŒ ì„¤ëª…ì— í•´ë‹¹í•˜ëŠ” ìš©ì–´ëŠ”?</h3>
        <p class="quiz-question">${question.definition}</p>
        ${optHtml}
        ${resultHtml}
        <button class="quiz-end" id="endQuizBtn">í€´ì¦ˆ ì¢…ë£Œ</button>
      `;
    }

    function startQuiz() {
      const learned = allTerms.filter(t => progress[t.docId]);
      if (learned.length < 2) { alert('ìµœì†Œ 2ê°œ ìš©ì–´ë¥¼ í•™ìŠµí•˜ì„¸ìš”!'); return; }
      const q = learned[Math.floor(Math.random() * learned.length)];
      const others = allTerms.filter(t => t.docId !== q.docId).sort(() => Math.random() - 0.5).slice(0, 3);
      quizData = { question: q, options: [...others, q].sort(() => Math.random() - 0.5), selected: null };
      renderQuiz();
    }

    function renderSearch(query) {
      const q = query.toLowerCase();
      const filtered = q ? allTerms.filter(t => (t.term && t.term.toLowerCase().includes(q)) || (t.definition && t.definition.toLowerCase().includes(q)) || (t.category && t.category.toLowerCase().includes(q))) : allTerms.slice(0, 8);
      document.getElementById('searchCount').textContent = q ? `ê²€ìƒ‰ ê²°ê³¼: ${filtered.length}ê°œ` : '';
      document.getElementById('searchResults').innerHTML = filtered.map(t => {
        const termIndex = allTerms.findIndex(at => at.docId === t.docId);
        const dayNum = Math.floor(termIndex / 4) + 1;
        const isBookmarked = bookmarks[t.docId];
        return `<div class="search-item" data-docid="${t.docId}" data-day="${dayNum}" style="cursor:pointer;"><div class="search-item-header"><span class="search-item-title">${isBookmarked ? 'â­ ' : ''}${t.term}</span><span class="card-category">${t.category || 'ì¼ë°˜'}</span></div><p class="search-item-desc">${t.simpleExplanation || t.definition || ''}</p><p style="font-size:0.75rem;color:#00d4ff;margin-top:8px;">ğŸ“ Day ${dayNum}</p></div>`;
      }).join('');
    }

    function renderWordList() {
      let filtered = allTerms;
      if (wordListFilter === 'completed') {
        filtered = allTerms.filter(t => progress[t.docId]);
      } else if (wordListFilter === 'incomplete') {
        filtered = allTerms.filter(t => !progress[t.docId]);
      } else if (wordListFilter === 'bookmarked') {
        filtered = allTerms.filter(t => bookmarks[t.docId]);
      }
      
      const completedCount = allTerms.filter(t => progress[t.docId]).length;
      const incompleteCount = allTerms.length - completedCount;
      const bookmarkedCount = allTerms.filter(t => bookmarks[t.docId]).length;
      
      let countText = `ì „ì²´ ${allTerms.length}ê°œ`;
      if (wordListFilter === 'completed') countText = `í•™ìŠµì™„ë£Œ ${completedCount}ê°œ`;
      else if (wordListFilter === 'incomplete') countText = `ë¯¸í•™ìŠµ ${incompleteCount}ê°œ`;
      else if (wordListFilter === 'bookmarked') countText = `ë¶ë§ˆí¬ ${bookmarkedCount}ê°œ`;
      
      document.getElementById('wordListCount').textContent = countText;
      
      document.querySelectorAll('#wordListSection .filter-btn').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.filter === wordListFilter);
      });
      
      document.getElementById('wordListResults').innerHTML = filtered.map(t => {
        const termIndex = allTerms.findIndex(at => at.docId === t.docId);
        const dayNum = Math.floor(termIndex / 4) + 1;
        const isCompleted = progress[t.docId];
        const isBookmarked = bookmarks[t.docId];
        return `
          <div class="wordlist-item ${isCompleted ? 'completed' : 'incomplete'} ${isBookmarked ? 'bookmarked-item' : ''}" data-docid="${t.docId}" data-day="${dayNum}">
            <div class="wordlist-item-header">
              <span class="wordlist-item-title">${t.term}</span>
              <div class="wordlist-item-badges">
                ${isBookmarked ? '<span class="wordlist-item-status bookmarked">â­</span>' : ''}
                <span class="wordlist-item-status ${isCompleted ? 'done' : 'notdone'}">${isCompleted ? 'âœ“ í•™ìŠµì™„ë£Œ' : 'â—‹ ë¯¸í•™ìŠµ'}</span>
              </div>
            </div>
            <p class="wordlist-item-desc">${t.simpleExplanation || t.definition || ''}</p>
            <p class="wordlist-item-day">ğŸ“ Day ${dayNum}</p>
          </div>
        `;
      }).join('') || '<p style="text-align:center;color:#888;padding:40px;">í•´ë‹¹í•˜ëŠ” ë‹¨ì–´ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
    }

    function switchTab(tab) {
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      hideAllSections();
      
      if (tab === 'learn') {
        document.getElementById('tabLearn').classList.add('active');
        if (currentView === 'learning') {
          document.getElementById('learnSection').classList.remove('hidden');
        } else {
          document.getElementById('daySelectSection').classList.remove('hidden');
        }
      } else if (tab === 'category') {
        document.getElementById('tabCategory').classList.add('active');
        document.getElementById('categorySection').classList.remove('hidden');
        document.getElementById('categoryGridView').classList.remove('hidden');
        document.getElementById('categoryListView').classList.add('hidden');
        renderCategoryGrid();
      } else if (tab === 'bookmark') {
        document.getElementById('tabBookmark').classList.add('active');
        document.getElementById('bookmarkSection').classList.remove('hidden');
        renderBookmarks();
      } else if (tab === 'wordlist') {
        document.getElementById('tabWordList').classList.add('active');
        document.getElementById('wordListSection').classList.remove('hidden');
        renderWordList();
      } else if (tab === 'quiz') {
        document.getElementById('tabQuiz').classList.add('active');
        document.getElementById('quizSection').classList.remove('hidden');
        renderQuiz();
      } else if (tab === 'search') {
        document.getElementById('tabSearch').classList.add('active');
        document.getElementById('searchSection').classList.remove('hidden');
      }
    }

    // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë“¤
    document.getElementById('tabLearn').addEventListener('click', () => switchTab('learn'));
    document.getElementById('tabCategory').addEventListener('click', () => switchTab('category'));
    document.getElementById('tabBookmark').addEventListener('click', () => switchTab('bookmark'));
    document.getElementById('tabWordList').addEventListener('click', () => switchTab('wordlist'));
    document.getElementById('tabQuiz').addEventListener('click', () => switchTab('quiz'));
    document.getElementById('tabSearch').addEventListener('click', () => switchTab('search'));
    
    document.getElementById('backToDaysBtn').addEventListener('click', showDaySelect);
    
    document.getElementById('nextDayBtn').addEventListener('click', () => {
      if (currentDay < totalDays) { currentDay++; expandedId = null; renderCards(); }
    });
    
    document.getElementById('searchInput').addEventListener('input', (e) => renderSearch(e.target.value));

    document.getElementById('searchResults').addEventListener('click', (e) => {
      const item = e.target.closest('.search-item');
      if (item) {
        const day = parseInt(item.dataset.day);
        const docId = item.dataset.docid;
        expandedId = docId;
        showLearning(day, true);
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.getElementById('tabLearn').classList.add('active');
        setTimeout(() => {
          const card = document.querySelector(`.card[data-id="${docId}"]`);
          if (card) card.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }, 100);
      }
    });

    document.getElementById('dayGrid').addEventListener('click', (e) => {
      const dayCard = e.target.closest('.day-card');
      if (dayCard) showLearning(parseInt(dayCard.dataset.day));
    });

    // ì¹´í…Œê³ ë¦¬ ì´ë²¤íŠ¸
    document.getElementById('categoryGrid').addEventListener('click', (e) => {
      const card = e.target.closest('.category-card');
      if (card) {
        selectedCategory = card.dataset.category;
        document.getElementById('categoryGridView').classList.add('hidden');
        document.getElementById('categoryListView').classList.remove('hidden');
        renderCategoryList(selectedCategory);
      }
    });

    document.getElementById('categoryBackBtn').addEventListener('click', () => {
      document.getElementById('categoryGridView').classList.remove('hidden');
      document.getElementById('categoryListView').classList.add('hidden');
      renderCategoryGrid();
    });

    document.getElementById('categoryListResults').addEventListener('click', (e) => {
      const item = e.target.closest('.wordlist-item');
      if (item) {
        const day = parseInt(item.dataset.day);
        const docId = item.dataset.docid;
        expandedId = docId;
        showLearning(day, true);
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.getElementById('tabLearn').classList.add('active');
        setTimeout(() => {
          const card = document.querySelector(`.card[data-id="${docId}"]`);
          if (card) card.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }, 100);
      }
    });

    // ë¶ë§ˆí¬ ì„¹ì…˜ ì´ë²¤íŠ¸
    document.getElementById('bookmarkResults').addEventListener('click', (e) => {
      const item = e.target.closest('.wordlist-item');
      if (item) {
        const day = parseInt(item.dataset.day);
        const docId = item.dataset.docid;
        expandedId = docId;
        showLearning(day, true);
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.getElementById('tabLearn').classList.add('active');
        setTimeout(() => {
          const card = document.querySelector(`.card[data-id="${docId}"]`);
          if (card) card.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }, 100);
      }
    });

    document.getElementById('wordListSection').addEventListener('click', (e) => {
      const filterBtn = e.target.closest('.filter-btn');
      if (filterBtn) {
        wordListFilter = filterBtn.dataset.filter;
        renderWordList();
        return;
      }
      
      const item = e.target.closest('.wordlist-item');
      if (item) {
        const day = parseInt(item.dataset.day);
        const docId = item.dataset.docid;
        expandedId = docId;
        showLearning(day, true);
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.getElementById('tabLearn').classList.add('active');
        setTimeout(() => {
          const card = document.querySelector(`.card[data-id="${docId}"]`);
          if (card) card.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }, 100);
      }
    });

    document.getElementById('cardsContainer').addEventListener('click', (e) => {
      const header = e.target.closest('.card-header');
      if (header) {
        const id = header.closest('.card').dataset.id;
        expandedId = (expandedId === id) ? null : id;
        renderCards();
        return;
      }
      
      const learnBtn = e.target.closest('.learn-btn[data-learn]');
      if (learnBtn) {
        const termId = learnBtn.dataset.learn;
        const isNewComplete = !progress[termId];
        progress[termId] = true;
        
        if (isNewComplete) {
          updateStreakOnComplete();
        }
        
        saveProgress();
        renderCards();
        return;
      }
      
      const bookmarkBtn = e.target.closest('.bookmark-btn[data-bookmark]');
      if (bookmarkBtn) {
        const termId = bookmarkBtn.dataset.bookmark;
        toggleBookmark(termId);
        renderCards();
        return;
      }
    });

    document.getElementById('quizContent').addEventListener('click', (e) => {
      if (e.target.id === 'startQuizBtn') { startQuiz(); return; }
      if (e.target.id === 'nextQuizBtn') { startQuiz(); return; }
      if (e.target.id === 'endQuizBtn') { quizData = null; renderQuiz(); return; }
      const optBtn = e.target.closest('.quiz-option');
      if (optBtn && quizData && quizData.selected === null) {
        quizData.selected = optBtn.dataset.option;
        renderQuiz();
      }
    });

    // ë”¥ë§í¬ ì²˜ë¦¬ - URL íŒŒë¼ë¯¸í„°ë¡œ íŠ¹ì • Dayë‚˜ ìš©ì–´ë¡œ ì´ë™
    function handleDeepLink() {
      const params = new URLSearchParams(window.location.search);
      
      // ?day=32 í˜•ì‹
      const dayParam = params.get('day');
      if (dayParam) {
        const day = parseInt(dayParam);
        if (day >= 1 && day <= totalDays) {
          setTimeout(() => {
            showLearning(day);
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.getElementById('tabLearn').classList.add('active');
          }, 500);
          return;
        }
      }
      
      // ?term=ê¸°ì¤€ê¸ˆë¦¬ í˜•ì‹
      const termParam = params.get('term');
      if (termParam) {
        const term = allTerms.find(t => t.term === termParam);
        if (term) {
          const termIndex = allTerms.findIndex(t => t.docId === term.docId);
          const day = Math.floor(termIndex / 4) + 1;
          expandedId = term.docId;
          setTimeout(() => {
            showLearning(day, true);
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.getElementById('tabLearn').classList.add('active');
            setTimeout(() => {
              const card = document.querySelector(`.card[data-id="${term.docId}"]`);
              if (card) card.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }, 100);
          }, 500);
          return;
        }
      }
      
      // ?id=125 í˜•ì‹
      const idParam = params.get('id');
      if (idParam) {
        const term = allTerms.find(t => t.docId === idParam || t.id === parseInt(idParam));
        if (term) {
          const termIndex = allTerms.findIndex(t => t.docId === term.docId);
          const day = Math.floor(termIndex / 4) + 1;
          expandedId = term.docId;
          setTimeout(() => {
            showLearning(day, true);
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.getElementById('tabLearn').classList.add('active');
            setTimeout(() => {
              const card = document.querySelector(`.card[data-id="${term.docId}"]`);
              if (card) card.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }, 100);
          }, 500);
          return;
        }
      }
    }

    // ì›ë˜ loadTerms í•¨ìˆ˜ ëì— ë”¥ë§í¬ ì²˜ë¦¬ ì¶”ê°€
    const originalLoadTerms = loadTerms;
    loadTerms = async function() {
      await originalLoadTerms();
      handleDeepLink();
    };
  </script>
</body>
</html>
